#
# MIT License
#
# (C) Copyright 2023 Hewlett Packard Enterprise Development LP
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included
# in all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
# OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
# ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
# OTHER DEALINGS IN THE SOFTWARE.
#
openapi: 3.0.1
info:
  title: TAPMS Tenant Status API
  description: Read-Only APIs to Retrieve Tenant Status
  contact: {}
  version: v1alpha1
servers:
- url: http://cray-tapms
  description: The service as exposed through Kubernetes DNS service mapping
paths:
  /v1/tenants:
    get:
      tags:
      - Tenant and Partition Management System
      summary: Get list of tenants' spec/status
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tenant'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
  /v1/tenants/{id}:
    get:
      tags:
      - Tenant and Partition Management System
      summary: Get a tenant's spec/status
      parameters:
      - name: id
        in: path
        description: Either the Name or UUID of the Tenant
        required: true
        schema:
          type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseError'
components:
  schemas:
    ResponseError:
      type: object
      properties:
        message:
          type: string
          example: Error Message...
    Tenant:
      required:
      - spec
      type: object
      properties:
        spec:
          $ref: '#/components/schemas/TenantSpec'
        status:
          $ref: '#/components/schemas/TenantStatus'
      description: The primary schema/definition of a tenant
    TenantResource:
      required:
      - type
      - xnames
      type: object
      properties:
        enforceexclusivehsmgroups:
          type: boolean
        hsmgrouplabel:
          type: string
          example: green
        hsmpartitionname:
          type: string
          example: blue
        type:
          type: string
          example: compute
        xnames:
          type: array
          example:
          - x0c3s5b0n0
          - x0c3s6b0n0
          items:
            type: string
      description: The desired resources for the Tenant
    TenantSpec:
      required:
      - tenantname
      - tenantresources
      type: object
      properties:
        childnamespaces:
          type: array
          example:
          - vcluster-blue-slurm
          items:
            type: string
        state:
          type: string
          example: New,Deploying,Deployed,Deleting
        tenantname:
          type: string
          example: vcluster-blue
        tenantresources:
          type: array
          description: The desired resources for the Tenant
          items:
            $ref: '#/components/schemas/TenantResource'
      description: The desired state of Tenant
    TenantStatus:
      type: object
      properties:
        childnamespaces:
          type: array
          example:
          - vcluster-blue-slurm
          items:
            type: string
        tenantresources:
          type: array
          description: The desired resources for the Tenant
          items:
            $ref: '#/components/schemas/TenantResource'
        uuid:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      description: The observed state of Tenant

